{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { useRouter } from 'next/router';\nimport setApi from '../../api';\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Creators } from \"../../ducks/machines\";\nimport { Row, Column } from '../../static/styled-components/base';\nimport loading from '../../static/images/loading.gif';\nexport default function ListProd(_ref) {\n  var id = _ref.id,\n      type = _ref.type,\n      search = _ref.search;\n  var router = useRouter();\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return state.Machine;\n  }),\n      machines = _useSelector.machines,\n      machinesForFilters = _useSelector.machinesForFilters,\n      filters = _useSelector.filters;\n\n  var _useState = useState([]),\n      prods = _useState[0],\n      setProds = _useState[1];\n\n  var _useState2 = useState(0),\n      indexPag = _useState2[0],\n      setIndexPag = _useState2[1];\n\n  var _useState3 = useState([]),\n      listProdsPag = _useState3[0],\n      setListProdsPag = _useState3[1];\n\n  var _useState4 = useState(false),\n      visLoading = _useState4[0],\n      setVisLoading = _useState4[1];\n\n  function f() {\n    var _machines, tools;\n\n    return _regeneratorRuntime.async(function f$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!search) {\n              _context.next = 30;\n              break;\n            }\n\n            console.log(\"search\", search);\n            _machines = {\n              data: []\n            };\n            tools = {\n              data: []\n            };\n            _context.prev = 4;\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(setApi().get(\"/machine?search=\".concat(search, \"&filters=\").concat(JSON.stringify(filters))));\n\n          case 7:\n            _machines = _context.sent;\n            //setListProdsPag(groupBy(machines.data, 10))\n            listP = _machines.data;\n            _context.next = 13;\n            break;\n\n          case 11:\n            _context.prev = 11;\n            _context.t0 = _context[\"catch\"](4);\n\n          case 13:\n            _context.prev = 13;\n            _context.next = 16;\n            return _regeneratorRuntime.awrap(setApi().get(\"/tools?search=\".concat(search)));\n\n          case 16:\n            tools = _context.sent;\n            console.log(\"tools >\", tools);\n            listP = tools.data;\n            _context.next = 23;\n            break;\n\n          case 21:\n            _context.prev = 21;\n            _context.t1 = _context[\"catch\"](13);\n\n          case 23:\n            setProds(_machines.data.concat(tools.data));\n            dispatch(Creators.loadMachines(_machines.data.concat(tools.data)));\n            dispatch(Creators.loadMachinesForFilters(_machines.data.concat(tools.data)));\n            setListProdsPag(groupBy(_machines.data.concat(tools.data), 10));\n            setVisLoading(false);\n            _context.next = 34;\n            break;\n\n          case 30:\n            if (!(type != \"tools\")) {\n              _context.next = 33;\n              break;\n            }\n\n            setApi().get(\"machine?\".concat(type, \"=\").concat(id, \"&filters=\").concat(JSON.stringify(filters))).then(function (res) {\n              dispatch(Creators.loadMachines(res.data));\n              dispatch(Creators.loadMachinesForFilters(res.data));\n              setProds(res.data);\n              setListProdsPag(groupBy(res.data, 10));\n              setVisLoading(false);\n            })[\"catch\"](function (err) {\n              setVisLoading(false);\n            });\n            return _context.abrupt(\"return\");\n\n          case 33:\n            setApi().get('/tools').then(function (response) {\n              console.log(response.data);\n              dispatch(Creators.loadMachines(response.data)); //dispatch(Creators.loadMachinesForFilters(response.data))\n\n              setProds(response.data);\n              setListProdsPag(groupBy(response.data, 10)); //setListProdsPag(groupBy(response.data, 10))\n\n              setVisLoading(false);\n            })[\"catch\"](function (err) {\n              setVisLoading(false);\n            });\n\n          case 34:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[4, 11], [13, 21]], Promise);\n  }\n\n  useEffect(function () {\n    setVisLoading(true);\n    f();\n  }, [id, type]); // useEffect(() => { \n  // \tsetListProdsPag(groupBy(machines, 10))\n  // }, [machines])\n\n  useEffect(function () {\n    if (type != \"tools\" && !search) {\n      setVisLoading(true);\n      setApi().get(\"machine?\".concat(type, \"=\").concat(id, \"&filters=\").concat(JSON.stringify(filters))).then(function (res) {\n        dispatch(Creators.loadMachines(res.data)); //dispatch(Creators.loadMachinesForFilters(res.data))\n\n        setProds(res.data);\n        setListProdsPag(groupBy(res.data, 10));\n        setVisLoading(false);\n      })[\"catch\"](function (err) {\n        dispatch(Creators.loadMachines([]));\n        setProds([]);\n        setListProdsPag(groupBy([], 10));\n        setVisLoading(false);\n      });\n      return;\n    }\n  }, [filters]);\n\n  function groupBy(arr, n) {\n    var group = [];\n\n    for (var i = 0, end = arr.length / n; i < end; ++i) {\n      group.push(arr.slice(i * n, (i + 1) * n));\n    }\n\n    return group;\n  }\n\n  return __jsx(Column, {\n    style: {\n      width: \"80%\",\n      margin: \"0 auto\",\n      flexWrap: 'wrap'\n    }\n  }, visLoading ? __jsx(\"img\", {\n    src: loading,\n    style: {\n      width: \"32px\",\n      margin: \"auto\",\n      display: \"block\"\n    }\n  }) : listProdsPag.length > 0 ? __jsx(Column, null, __jsx(\"h1\", null, search ? 'Resultado da sua busca' : ''), __jsx(Row, {\n    style: {\n      flexWrap: 'wrap'\n    }\n  }, listProdsPag[indexPag].map(function (prod) {\n    return __jsx(Column, {\n      key: prod.id,\n      style: {\n        width: \"32%\",\n        cursor: \"pointer\",\n        marginRight: \"1.3%\",\n        minWidth: \"280px\"\n      },\n      onClick: function onClick() {\n        return router.push({\n          pathname: \"/produto\",\n          query: {\n            id: prod.id\n          }\n        });\n      },\n      ait: \"center\"\n    }, __jsx(Img, {\n      src: prod.images.length > 0 ? prod.images[0] : '',\n      width: \"100%\",\n      height: \"280px\"\n    }), __jsx(Name, null, prod.name));\n  })), __jsx(Row, {\n    jc: \"center\",\n    ait: \"center\"\n  }, __jsx(PagItem, {\n    onClick: function onClick() {\n      indexPag < 0 ? '' : setIndexPag(indexPag - 1);\n    }\n  }, '<'), listProdsPag.map(function (a, i) {\n    return __jsx(PagItem, {\n      key: i,\n      current: indexPag == i,\n      onClick: function onClick() {\n        return setIndexPag(i);\n      }\n    }, i);\n  }), __jsx(PagItem, {\n    onClick: function onClick() {\n      listProdsPag.length == indexPag + 1 ? '' : setIndexPag(indexPag + 1);\n    }\n  }, '>'))) : __jsx(Name, {\n    style: {\n      margin: \"auto\"\n    }\n  }, \"Nenhuma m\\xE1quina encontrada\"));\n}\nvar Name = styled.p.withConfig({\n  displayName: \"ListProds__Name\",\n  componentId: \"sc-10dqkm5-0\"\n})([\"text-align:center;font-family:Segoe UI;letter-spacing:0;color:#000000;opacity:1;\"]);\nvar PagItem = styled.p.withConfig({\n  displayName: \"ListProds__PagItem\",\n  componentId: \"sc-10dqkm5-1\"\n})([\"cursor:pointer;padding:5px;transition:.2s;color:\", \";:hover{opacity:.8;}\"], function (props) {\n  return props.current ? 'red' : '#5B5B5B';\n});\nvar Img = styled.div.withConfig({\n  displayName: \"ListProds__Img\",\n  componentId: \"sc-10dqkm5-2\"\n})([\"background-image:url('\", \"');background-size:80%;background-position:center;background-repeat:no-repeat;width:\", \";height:\", \";transform:translateX(\", \"px);transition:transform 0.2s ease-in-out;position:relative;:hover{transform:scale(1.1);-webkit-transform:scale(1.1);}\"], function (props) {\n  return props.src;\n}, function (props) {\n  return props.width;\n}, function (props) {\n  return props.height;\n}, function (props) {\n  return props.translate;\n});","map":null,"metadata":{},"sourceType":"module"}