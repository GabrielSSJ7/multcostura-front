{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { Router, Link } from \"../../../routes\";\nimport setApi from \"../../../src/api\";\nimport EditGalleryImages from \"../../../src/components/admin/news/EditGalleryImages\";\nimport EditGalleryVideos from \"../../../src/components/admin/news/EditGalleryVideos\";\nimport Snackbar from \"@material-ui/core/Snackbar\";\nimport Alert from \"@material-ui/lab/Alert\";\nimport Template from \"../../../src/components/templates/Admin\";\nimport Sidebar from \"../../../src/components/admin/Sidebar\";\nimport { Container, Button, Input, TextArea, Hr } from \"../../../src/static/styled-components/base\";\nimport loadingGif from \"../../../src/static/images/loading.gif\";\nimport InputMask from \"react-input-mask\";\nexport default function EditNews({\n  id\n}) {\n  const {\n    0: news,\n    1: setNews\n  } = useState({});\n  const {\n    0: images,\n    1: setImages\n  } = useState([]);\n  const {\n    0: videos,\n    1: setVideos\n  } = useState([]);\n  const {\n    0: dis,\n    1: setDis\n  } = useState(false);\n  const {\n    0: form,\n    1: setForm\n  } = useState({\n    title: \"\",\n    description: \"\",\n    date: \"\"\n  });\n  useEffect(() => {\n    async function async() {\n      setApi().get(\"/news/\" + id).then(response => {\n        setNews(response.data);\n        setForm(_objectSpread({}, response.data));\n      }).catch(err => {\n        setSnackBar({\n          open: true,\n          message: err.response ? err.response.data.toString() : err.toString()\n        });\n      });\n\n      _getImages();\n    }\n\n    async();\n  }, []);\n  useEffect(() => {\n    if (form.description.length >= 200) {\n      setDis(true);\n      setSnackBar({\n        open: true,\n        result: \"error\",\n        message: \"A descrição deve ter no máximo 200 caractéres\"\n      });\n    } else {\n      setDis(false);\n    }\n  }, [form.description]);\n\n  function _getImages() {\n    getImages(id, function (err, r) {\n      if (err) {\n        setSnackBar({\n          result: \"error\",\n          open: true,\n          message: err.response ? err.response.data.toString() : err.toString()\n        });\n        return;\n      }\n\n      setVideos(r.gallery.videos);\n      setImages(r.gallery.images);\n    });\n  }\n\n  const {\n    0: galleryOpen,\n    1: setGalleryOpen\n  } = useState(false);\n  const {\n    0: snackBar,\n    1: setSnackBar\n  } = useState({\n    result: \"success\",\n    open: false,\n    message: \"\"\n  });\n\n  function handleChange(e) {\n    setForm(_objectSpread({}, form, {\n      [e.target.name]: e.target.value\n    }));\n  }\n\n  function editNews() {\n    setApi().put(\"/news/\" + id, _objectSpread({}, form)).then(response => {\n      setSnackBar({\n        open: true,\n        result: \"success\",\n        message: \"Notícia editada com sucesso!\"\n      });\n    }).catch(err => {\n      setSnackBar({\n        open: true,\n        result: \"error\",\n        message: err.response ? err.response.data.toString() : err.toString()\n      });\n    });\n  }\n\n  function handleClose() {\n    setSnackBar(_objectSpread({}, snackBar, {\n      open: false\n    }));\n  }\n\n  function deleteNews() {\n    setApi().delete(\"/news/\" + id).then(response => {\n      setSnackBar({\n        open: true,\n        result: \"success\",\n        message: `Notícia ${form.title} excluída com sucesso`\n      });\n      Router.pushRoute(\"/admin/news\");\n    }).catch(err => {\n      setSnackBar({\n        result: \"error\",\n        open: true,\n        message: err.response ? err.response.data.toString() : err.toString()\n      });\n    });\n  }\n\n  function removeImage(index) {\n    setApi({\n      model: \"news\",\n      type: \"images\",\n      index\n    }).delete(\"/gallery/\" + id).then(response => {\n      setSnackBar({\n        open: true,\n        result: \"success\",\n        message: \"A imagem foi excluida com sucesso!\"\n      });\n\n      _getImages();\n    }).catch(err => {\n      setSnackBar({\n        open: true,\n        result: \"error\",\n        message: err.response ? err.response.data.toString() : err.toString()\n      });\n    });\n  }\n\n  function removeVideo(index) {\n    setApi({\n      model: \"news\",\n      type: \"videos\",\n      index\n    }).delete(\"/gallery/\" + id).then(response => {\n      setSnackBar({\n        open: true,\n        result: \"success\",\n        message: \"O video foi excluido com sucesso!\"\n      });\n\n      _getImages();\n    }).catch(err => {\n      setSnackBar({\n        open: true,\n        result: \"error\",\n        message: err.response ? err.response.data.toString() : err.toString()\n      });\n    });\n  }\n\n  function onSuccess() {\n    _getImages();\n\n    setSnackBar({\n      open: true,\n      result: \"success\",\n      message: \"Os arquivos foram enviados com sucesso\"\n    });\n  }\n\n  function onError(e) {\n    setSnackBar({\n      open: true,\n      result: \"error\",\n      message: e.toString()\n    });\n  }\n\n  return __jsx(Template, null, __jsx(Snackbar, {\n    open: snackBar.open,\n    autoHideDuration: 3500,\n    onClose: handleClose\n  }, __jsx(Alert, {\n    severity: snackBar.result\n  }, snackBar.message)), __jsx(Sidebar, null), __jsx(Container, null, __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      justifyContent: \"space-around\"\n    }\n  }, __jsx(\"h1\", {\n    className: \"main-title\",\n    style: {\n      textAlign: \"center\",\n      color: \"rgb(35,43,111)\"\n    }\n  }, \"Editar \", form.title)), __jsx(Hr, null), __jsx(Form, null, __jsx(Input, {\n    placeholder: \"T\\xEDtulo\",\n    onChange: handleChange,\n    name: \"title\",\n    id: \"title\",\n    value: form.title\n  }), __jsx(TextArea, {\n    placeholder: \"Descri\\xE7\\xE3o\",\n    onChange: handleChange,\n    name: \"description\",\n    id: \"description\",\n    value: form.description,\n    rows: \"5\",\n    style: {\n      border: dis ? '2px solid red' : '',\n      outline: 'none',\n      resize: 'none'\n    }\n  }), __jsx(InputMask, {\n    placeholder: \"Data\",\n    className: \"form-control\",\n    mask: \"99/99/9999\",\n    name: \"date\",\n    maskChar: null,\n    onChange: handleChange,\n    value: form.date\n  }), __jsx(Button, {\n    style: {\n      opacity: dis ? \".8\" : \"1\"\n    },\n    onClick: editNews,\n    disabled: dis\n  }, \"Editar\"), !galleryOpen ? __jsx(Button, {\n    onClick: () => setGalleryOpen(true)\n  }, \"Atualizar Galeria de fotos e v\\xEDdeos\") : \"\", galleryOpen ? __jsx(\"div\", null, __jsx(EditGalleryImages, {\n    images: images,\n    removeImage: removeImage,\n    onSuccess: onSuccess,\n    onError: onError,\n    headers: {\n      model: \"news\",\n      type: \"images\",\n      id\n    }\n  }), \" \", __jsx(EditGalleryVideos, {\n    images: videos,\n    removeVideo: removeVideo,\n    onSuccess: onSuccess,\n    onError: onError,\n    headers: {\n      model: \"news\",\n      type: \"videos\",\n      id\n    }\n  }), \" \") : \"\", __jsx(Button, {\n    onClick: deleteNews\n  }, \"Excluir esta not\\xEDcia\"))));\n}\n\nfunction getImages(id, cb) {\n  setApi({\n    model: \"news\"\n  }).get(`/news/${id}`).then(response => {\n    cb(null, response.data);\n  }).catch(err => {\n    cb(err);\n  });\n}\n\nEditNews.getInitialProps = ({\n  query\n}) => {\n  return {\n    id: query.id\n  };\n};\n\nconst Form = styled.div.withConfig({\n  displayName: \"edit-news__Form\",\n  componentId: \"sc-1pzc2ot-0\"\n})([\"display:flex;flex-direction:column;margin:20px;justify-content:space-between;\"]);","map":{"version":3,"sources":["C:/Users/Gluz/Projects/web/multcostura/multcostura-web/pages/admin/news/edit-news.js"],"names":["React","useState","useEffect","styled","Router","Link","setApi","EditGalleryImages","EditGalleryVideos","Snackbar","Alert","Template","Sidebar","Container","Button","Input","TextArea","Hr","loadingGif","InputMask","EditNews","id","news","setNews","images","setImages","videos","setVideos","dis","setDis","form","setForm","title","description","date","async","get","then","response","data","catch","err","setSnackBar","open","message","toString","_getImages","length","result","getImages","r","gallery","galleryOpen","setGalleryOpen","snackBar","handleChange","e","target","name","value","editNews","put","handleClose","deleteNews","delete","pushRoute","removeImage","index","model","type","removeVideo","onSuccess","onError","display","justifyContent","textAlign","color","border","outline","resize","opacity","cb","getInitialProps","query","Form","div"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { Router, Link } from \"../../../routes\";\r\n\r\nimport setApi from \"../../../src/api\";\r\n\r\nimport EditGalleryImages from \"../../../src/components/admin/news/EditGalleryImages\";\r\nimport EditGalleryVideos from \"../../../src/components/admin/news/EditGalleryVideos\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport Template from \"../../../src/components/templates/Admin\";\r\nimport Sidebar from \"../../../src/components/admin/Sidebar\";\r\nimport {\r\n  Container,\r\n  Button,\r\n  Input,\r\n  TextArea,\r\n  Hr\r\n} from \"../../../src/static/styled-components/base\";\r\nimport loadingGif from \"../../../src/static/images/loading.gif\";\r\n\r\nimport InputMask from \"react-input-mask\";\r\n\r\nexport default function EditNews({ id }) {\r\n  const [news, setNews] = useState({});\r\n  const [images, setImages] = useState([]);\r\n  const [videos, setVideos] = useState([]);\r\n  const [dis, setDis] = useState(false)\r\n  const [form, setForm] = useState({\r\n    title: \"\",\r\n    description: \"\",\r\n    date: \"\"\r\n  });\r\n  useEffect(() => {\r\n    async function async() {\r\n      setApi()\r\n        .get(\"/news/\" + id)\r\n        .then(response => {\r\n          setNews(response.data);\r\n          setForm({ ...response.data });\r\n        })\r\n        .catch(err => {\r\n          setSnackBar({\r\n            open: true,\r\n            message: err.response\r\n              ? err.response.data.toString()\r\n              : err.toString()\r\n          });\r\n        });\r\n\r\n      _getImages();\r\n    }\r\n    async();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n      if (form.description.length >= 200) {\r\n        setDis(true);\r\n        setSnackBar({\r\n          open: true,\r\n          result: \"error\",\r\n          message: \"A descrição deve ter no máximo 200 caractéres\"\r\n        })\r\n      } else {\r\n        setDis(false)\r\n      }\r\n  }, [form.description])\r\n\r\n  function _getImages() {\r\n    getImages(id, function(err, r) {\r\n      if (err) {\r\n        setSnackBar({\r\n          result: \"error\",\r\n          open: true,\r\n          message: err.response ? err.response.data.toString() : err.toString()\r\n        });\r\n        return;\r\n      }\r\n      setVideos(r.gallery.videos);\r\n      setImages(r.gallery.images);\r\n    });\r\n  }\r\n\r\n  const [galleryOpen, setGalleryOpen] = useState(false);\r\n  const [snackBar, setSnackBar] = useState({\r\n    result: \"success\",\r\n    open: false,\r\n    message: \"\"\r\n  });\r\n\r\n  function handleChange(e) {\r\n    \r\n    setForm({\r\n      ...form,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  }\r\n\r\n  function editNews() {\r\n    setApi()\r\n      .put(\"/news/\" + id, { ...form })\r\n      .then(response => {\r\n        setSnackBar({\r\n          open: true,\r\n          result: \"success\",\r\n          message: \"Notícia editada com sucesso!\"\r\n        });\r\n      })\r\n      .catch(err => {\r\n        setSnackBar({\r\n          open: true,\r\n          result: \"error\",\r\n          message: err.response ? err.response.data.toString() : err.toString()\r\n        });\r\n      });\r\n  }\r\n\r\n  function handleClose() {\r\n    setSnackBar({\r\n      ...snackBar,\r\n      open: false\r\n    });\r\n  }\r\n\r\n  function deleteNews() {\r\n    setApi()\r\n      .delete(\"/news/\" + id)\r\n      .then(response => {\r\n        setSnackBar({\r\n          open: true,\r\n          result: \"success\",\r\n          message: `Notícia ${form.title} excluída com sucesso`\r\n        });\r\n        Router.pushRoute(\"/admin/news\");\r\n      })\r\n      .catch(err => {\r\n        setSnackBar({\r\n          result: \"error\",\r\n          open: true,\r\n          message: err.response ? err.response.data.toString() : err.toString()\r\n        });\r\n      });\r\n  }\r\n\r\n  function removeImage(index) {\r\n    setApi({ model: \"news\", type: \"images\", index })\r\n      .delete(\"/gallery/\" + id)\r\n      .then(response => {\r\n        setSnackBar({\r\n          open: true,\r\n          result: \"success\",\r\n          message: \"A imagem foi excluida com sucesso!\"\r\n        });\r\n        _getImages();\r\n      })\r\n      .catch(err => {\r\n        setSnackBar({\r\n          open: true,\r\n          result: \"error\",\r\n          message: err.response ? err.response.data.toString() : err.toString()\r\n        });\r\n      });\r\n  }\r\n  function removeVideo(index) {\r\n    setApi({ model: \"news\", type: \"videos\", index })\r\n      .delete(\"/gallery/\" + id)\r\n      .then(response => {\r\n        setSnackBar({\r\n          open: true,\r\n          result: \"success\",\r\n          message: \"O video foi excluido com sucesso!\"\r\n        });\r\n        _getImages();\r\n      })\r\n      .catch(err => {\r\n        setSnackBar({\r\n          open: true,\r\n          result: \"error\",\r\n          message: err.response ? err.response.data.toString() : err.toString()\r\n        });\r\n      });\r\n  }\r\n  function onSuccess() {\r\n    _getImages();\r\n    setSnackBar({\r\n      open: true,\r\n      result: \"success\",\r\n      message: \"Os arquivos foram enviados com sucesso\"\r\n    });\r\n  }\r\n  function onError(e) {\r\n    setSnackBar({\r\n      open: true,\r\n      result: \"error\",\r\n      message: e.toString()\r\n    });\r\n  }\r\n  return (\r\n    <Template>\r\n      <Snackbar\r\n        open={snackBar.open}\r\n        autoHideDuration={3500}\r\n        onClose={handleClose}\r\n      >\r\n        <Alert severity={snackBar.result}>{snackBar.message}</Alert>\r\n      </Snackbar>\r\n      <Sidebar />\r\n\r\n      <Container>\r\n        <div style={{ display: \"flex\", justifyContent: \"space-around\" }}>\r\n          <h1\r\n            className=\"main-title\"\r\n            style={{\r\n              textAlign: \"center\",\r\n              color: \"rgb(35,43,111)\"\r\n            }}\r\n          >\r\n            Editar {form.title}\r\n          </h1>\r\n        </div>\r\n        <Hr />\r\n        <Form>\r\n          <Input\r\n            placeholder=\"Título\"\r\n            onChange={handleChange}\r\n            name=\"title\"\r\n            id=\"title\"\r\n            value={form.title}\r\n          />\r\n          <TextArea\r\n            placeholder=\"Descrição\"\r\n            onChange={handleChange}\r\n            name=\"description\"\r\n            id=\"description\"\r\n            value={form.description}\r\n            rows=\"5\"\r\n            style={{ border: dis ? '2px solid red' : '', outline: 'none', resize: 'none'}}\r\n          />\r\n\r\n          <InputMask\r\n            placeholder=\"Data\"\r\n            className=\"form-control\"\r\n            mask=\"99/99/9999\"\r\n            name=\"date\"\r\n            maskChar={null}\r\n            onChange={handleChange}\r\n            value={form.date}\r\n          />\r\n\r\n          <Button style={{ opacity: dis ? \".8\" : \"1\"}} onClick={editNews} disabled={dis}>Editar</Button>\r\n          {!galleryOpen ? (\r\n            <Button onClick={() => setGalleryOpen(true)}>\r\n              Atualizar Galeria de fotos e vídeos\r\n            </Button>\r\n          ) : (\r\n            \"\"\r\n          )}\r\n          {galleryOpen ? (\r\n            <div>\r\n              <EditGalleryImages\r\n                images={images}\r\n                removeImage={removeImage}\r\n                onSuccess={onSuccess}\r\n                onError={onError}\r\n                headers={{ model: \"news\", type: \"images\", id }}\r\n              />{\" \"}\r\n              <EditGalleryVideos\r\n                images={videos}\r\n                removeVideo={removeVideo}\r\n                onSuccess={onSuccess}\r\n                onError={onError}\r\n                headers={{ model: \"news\", type: \"videos\", id }}\r\n              />{\" \"}\r\n            </div>\r\n          ) : (\r\n            \"\"\r\n          )}\r\n          <Button onClick={deleteNews}>Excluir esta notícia</Button>\r\n        </Form>\r\n      </Container>\r\n    </Template>\r\n  );\r\n}\r\n\r\nfunction getImages(id, cb) {\r\n  setApi({ model: \"news\" })\r\n    .get(`/news/${id}`)\r\n    .then(response => {\r\n      cb(null, response.data);\r\n    })\r\n    .catch(err => {\r\n      cb(err);\r\n    });\r\n}\r\n\r\nEditNews.getInitialProps = ({ query }) => {\r\n  return { id: query.id };\r\n};\r\n\r\nconst Form = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin: 20px;\r\n  justify-content: space-between;\r\n`;\r\n"]},"metadata":{},"sourceType":"module"}