{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from \"react\";\nimport { useDispatch } from 'react-redux';\nimport setApi from '../../../api';\nimport Head from 'next/head';\nimport InputMask from \"react-input-mask\";\nimport { Input, Button, Column } from \"../../../static/styled-components/base\";\nimport { getResellers } from '../../../utils/reseller';\nimport Message from \"../../utils/Message\";\nimport { Creators as ResellerCreators } from '../../../ducks/resellers';\nimport Snackbar from \"@material-ui/core/Snackbar\";\nimport Alert from \"@material-ui/lab/Alert\";\nexport default (function () {\n  var _useState = useState(\"\"),\n      name = _useState[0],\n      setName = _useState[1];\n\n  var _useState2 = useState(\"\"),\n      email = _useState2[0],\n      setEmail = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      phone = _useState3[0],\n      setPhone = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      publicPlace = _useState4[0],\n      setPublicPlace = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      district = _useState5[0],\n      setDistrict = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      city = _useState6[0],\n      setCity = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      state = _useState7[0],\n      setState = _useState7[1];\n\n  var _useState8 = useState(\"\"),\n      country = _useState8[0],\n      setCountry = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      number = _useState9[0],\n      setNumber = _useState9[1];\n\n  var _useState10 = useState(false),\n      visible = _useState10[0],\n      setVisible = _useState10[1];\n\n  var _useState11 = useState(\"\"),\n      message = _useState11[0],\n      setMessage = _useState11[1];\n\n  var _useState12 = useState(false),\n      result = _useState12[0],\n      setResult = _useState12[1];\n\n  var _useState13 = useState(\"red\"),\n      color = _useState13[0],\n      setColor = _useState13[1];\n\n  var _useState14 = useState([]),\n      listAddress = _useState14[0],\n      setListAddress = _useState14[1];\n\n  var _useState15 = useState(false),\n      listAddressVis = _useState15[0],\n      setListAddressVis = _useState15[1];\n\n  var _useState16 = useState(\"\"),\n      address = _useState16[0],\n      setAddress = _useState16[1];\n\n  var _useState17 = useState({\n    result: \"success\",\n    open: false,\n    message: \"\"\n  }),\n      snackBar = _useState17[0],\n      setSnackBar = _useState17[1];\n\n  var dispatch = useDispatch();\n  useEffect(function () {\n    function asyncFunc() {\n      var response, fAddress, sugestion, formattedAddress;\n      return _regeneratorRuntime.async(function asyncFunc$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(setApi().get(\"http://dev.virtualearth.net/REST/v1/Autosuggest?query=\".concat(address, \"&maxResults=5&key=ArBcF40dX4IT5Co3SIxT7TfvEqq3VNdafH09G2lYGLmm1PvaaFwU-xHaQLjtmpDe\")));\n\n            case 2:\n              response = _context.sent;\n              fAddress = response.data.resourceSets[0].resources[0].value;\n              sugestion = [];\n\n              for (formattedAddress in response.data.resourceSets[0].resources[0].value) {\n                sugestion.push(fAddress[formattedAddress].address.formattedAddress);\n              }\n\n              setListAddress(sugestion);\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n\n    asyncFunc();\n  }, [address]);\n\n  var focusOutEvent = function focusOutEvent(event) {\n    timeout = setTimeout(function () {\n      setListAddressVis(false);\n    }, 100);\n  };\n\n  useEffect(function () {\n    var input = document.getElementById('searchBox');\n    var timeout = null;\n    input.addEventListener('focusout', focusOutEvent);\n    return function () {\n      clearTimeout(timeout);\n      input.removeEventListener('focusout', focusOutEvent);\n    };\n  }, []);\n\n  function handleClose() {\n    setSnackBar(_objectSpread({}, snackBar, {\n      open: false\n    }));\n  }\n\n  function geoCoding(where) {\n    var response;\n    return _regeneratorRuntime.async(function geoCoding$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(setApi().get(\"http://dev.virtualearth.net/REST/v1/Locations?addressLine=\".concat(where, \"&maxResults=1&key=\").concat(process.env.mapsKey)));\n\n          case 2:\n            response = _context2.sent;\n\n            if (!(response.data.resourceSets[0].estimatedTotal != 0)) {\n              _context2.next = 7;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", response.data.resourceSets[0].resources[0].geocodePoints);\n\n          case 7:\n            setSnackBar({\n              open: true,\n              message: \"Não possível encontrar este endereço no mapa\",\n              result: 'error'\n            });\n            return _context2.abrupt(\"return\", false);\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  return __jsx(React.Fragment, null, __jsx(Head, null, __jsx(\"script\", {\n    type: \"text/javascript\",\n    src: process.env.mapsKey,\n    async: true,\n    defer: true\n  })), __jsx(Snackbar, {\n    open: snackBar.open,\n    autoHideDuration: 3500,\n    onClose: handleClose\n  }, __jsx(Alert, {\n    severity: snackBar.result\n  }, snackBar.message)), __jsx(\"h3\", {\n    className: \"main-title\",\n    style: {\n      color: \"rgb(129, 22, 27)\"\n    }\n  }, \"Adicionar novo revendedor\"), __jsx(\"div\", null, __jsx(Row, null, __jsx(Input, {\n    placeholder: \"Nome\",\n    onChange: function onChange(e) {\n      return setName(e.target.value);\n    },\n    value: name,\n    onKeyDown: Enter,\n    style: {\n      flex: 2,\n      marginRight: \"5px\"\n    }\n  }), __jsx(Input, {\n    placeholder: \"Email\",\n    onChange: function onChange(e) {\n      return setEmail(e.target.value);\n    },\n    value: email,\n    style: {\n      flex: 2,\n      marginRight: \"5px\"\n    },\n    onKeyDown: Enter\n  }), __jsx(InputMask, {\n    style: {\n      flex: 1\n    },\n    placeholder: \"Telefone\",\n    onChange: function onChange(e) {\n      return setPhone(e.target.value);\n    },\n    value: phone,\n    mask: \"+99 99 99999-9999\",\n    maskChar: \" \",\n    className: \"form-control\",\n    onKeyDown: Enter\n  })), __jsx(Column, {\n    style: {\n      position: \"relative\"\n    }\n  }, __jsx(\"div\", {\n    id: \"printoutPanel\"\n  }), __jsx(\"div\", {\n    id: \"searchBoxContainer\"\n  }, __jsx(\"input\", {\n    onFocus: function onFocus() {\n      return setListAddressVis(true);\n    },\n    className: \"form-control\",\n    type: \"text\",\n    autoComplete: \"new-password\",\n    placeholder: \"Digite o endere\\xE7o\",\n    id: \"searchBox\",\n    value: address,\n    onChange: function onChange(e) {\n      return setAddress(e.target.value);\n    }\n  })), listAddressVis ? __jsx(Column, {\n    onMouseEnter: function onMouseEnter() {\n      return setListAddressVis(true);\n    },\n    style: {\n      background: 'white',\n      boxShadow: '1px 1px 3px grey',\n      borderRadius: '5px',\n      padding: '10px',\n      position: \"absolute\",\n      top: \"50px\",\n      width: \"80%\"\n    }\n  }, listAddress.length > 0 ? listAddress.map(function (ad, i) {\n    return __jsx(Item, {\n      key: i,\n      onClick: function onClick() {\n        setAddress(ad);\n        console.log(ad);\n      },\n      style: {\n        borderBottom: \"1px solid grey\"\n      }\n    }, ad);\n  }) : __jsx(Item, null, \"Nenhuma sugest\\xE3o encontrada\")) : '')), visible ? __jsx(Message, {\n    result: result,\n    color: color,\n    message: message\n  }) : \"\", __jsx(Button, {\n    onClick: function onClick() {\n      return createReseller();\n    }\n  }, \"Criar categoria\"));\n\n  function createReseller() {\n    var geocode;\n    return _regeneratorRuntime.async(function createReseller$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(geoCoding(address));\n\n          case 2:\n            geocode = _context3.sent;\n\n            if (geocode) {\n              _context3.next = 5;\n              break;\n            }\n\n            return _context3.abrupt(\"return\");\n\n          case 5:\n            setApi().post(\"/reseller\", {\n              name: name,\n              phone: phone,\n              email: email,\n              address: address,\n              geocode: {\n                lat: geocode[0].coordinates[0],\n                lng: geocode[0].coordinates[1]\n              }\n            }).then(function (response) {\n              setResult(true);\n              setColor(\"green\");\n              setMessage(\"Revendedor criado com sucesso\");\n              setVisible(true);\n              getResellers(function (err, data) {\n                dispatch(ResellerCreators.loadResellers(data));\n              });\n              resetForm();\n            })[\"catch\"](function (err) {\n              setResult(false);\n              setMessage(err.response ? err.response.data : err.toString());\n              setVisible(true);\n            });\n\n          case 6:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function Enter(e) {\n    if (e.key == \"Enter\") {\n      createReseller();\n    }\n  }\n\n  function resetForm() {\n    setName(\"\");\n    setEmail(\"\");\n    setPhone(\"\");\n    setAddress(\"\");\n  }\n});\nimport styled from \"styled-components\";\nvar Item = styled.p.withConfig({\n  displayName: \"AddResellers__Item\",\n  componentId: \"sc-1jbnz8c-0\"\n})([\"font-size:1rem;cursor:pointer;transition:.4s;:hover{opacity:.9;color:#81161B;}z-index:9;margin:0;padding:12px 0;:last-child{border-bottom:none !important;}\"]);\nexport var Row = styled.div.withConfig({\n  displayName: \"AddResellers__Row\",\n  componentId: \"sc-1jbnz8c-1\"\n})([\"display:flex;width:100%;flex-direction:row;justify-content:space-between;input{margin-right:5px;}\"]);","map":null,"metadata":{},"sourceType":"module"}